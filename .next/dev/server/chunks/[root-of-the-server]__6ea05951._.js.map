{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/game/IIITH/src/app/api/analyze/route.ts"],"sourcesContent":["'use server'\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport ZAI from 'z-ai-web-dev-sdk'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { question } = await request.json()\n\n    if (!question || typeof question !== 'string') {\n      return NextResponse.json(\n        { error: 'Invalid question' },\n        { status: 400 }\n      )\n    }\n\n    // Initialize ZAI SDK\n    const zai = await ZAI.create()\n\n    // Analyze the question using LLM\n    const analysisPrompt = `Analyze this user question and provide a structured analysis in JSON format:\n\nQuestion: \"${question}\"\n\nProvide the analysis in this exact JSON format:\n{\n  \"type\": \"factual|comparative|analytical|aggregative|yes/no\",\n  \"complexity\": number (1-10),\n  \"entities\": [\"entity1\", \"entity2\", ...],\n  \"expectedChunks\": number (2-15),\n  \"confidence\": number (0-100)\n}\n\nTypes:\n- factual: Simple definition or fact-based question\n- comparative: Comparing multiple items or options\n- analytical: Why/how questions requiring reasoning\n- aggregative: List/summary questions\n- yes/no: Simple verification questions\n\nComplexity score:\n1-3: Simple (one concept, direct answer)\n4-7: Medium (multiple concepts, some reasoning)\n8-10: Complex (multiple concepts, deep reasoning, time dimension)\n\nEntities: Key words/concepts mentioned in the question\n\nExpected chunks: How many document chunks are likely needed\n- factual: 2-3 chunks\n- yes/no: 1-2 chunks\n- comparative: 6-10 chunks\n- analytical: 5-8 chunks\n- aggregative: 10-15 chunks\n\nConfidence: How confident are you in this analysis (0-100)\n\nReturn ONLY the JSON, no other text.`\n\n    const completion = await zai.chat.completions.create({\n      messages: [\n        {\n          role: 'assistant',\n          content: 'You are an expert at analyzing questions and determining the optimal information retrieval strategy. Always respond with valid JSON.'\n        },\n        {\n          role: 'user',\n          content: analysisPrompt\n        }\n      ],\n      thinking: { type: 'disabled' }\n    })\n\n    const responseText = completion.choices[0]?.message?.content || '{}'\n\n    // Parse the JSON response\n    let analysis\n    try {\n      // Extract JSON from response (in case there's extra text)\n      const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/)\n      const jsonText = jsonMatch ? jsonMatch[0] : responseText\n      analysis = JSON.parse(jsonText)\n    } catch (error) {\n      console.error('Failed to parse analysis JSON:', error)\n      // Fallback to default analysis\n      analysis = {\n        type: 'factual',\n        complexity: 3,\n        entities: [],\n        expectedChunks: 3,\n        confidence: 50\n      }\n    }\n\n    // Validate and normalize the analysis\n    const validTypes = ['factual', 'comparative', 'analytical', 'aggregative', 'yes/no']\n    const type = validTypes.includes(analysis.type) ? analysis.type : 'factual'\n    const complexity = Math.max(1, Math.min(10, analysis.complexity || 3))\n    const entities = Array.isArray(analysis.entities) ? analysis.entities : []\n    const chunksNeeded = Math.max(2, Math.min(15, analysis.expectedChunks || 3))\n    const confidence = Math.max(0, Math.min(100, analysis.confidence || 70))\n\n    return NextResponse.json({\n      type,\n      complexity,\n      entities,\n      chunksNeeded,\n      confidence\n    })\n  } catch (error) {\n    console.error('Analysis error:', error)\n\n    // Return fallback analysis\n    return NextResponse.json({\n      type: 'factual',\n      complexity: 3,\n      entities: [],\n      chunksNeeded: 3,\n      confidence: 50\n    })\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEvC,IAAI,CAAC,YAAY,OAAO,aAAa,UAAU;YAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmB,GAC5B;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,MAAM,MAAM,0KAAG,CAAC,MAAM;QAE5B,iCAAiC;QACjC,MAAM,iBAAiB,CAAC;;WAEjB,EAAE,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;oCAkCc,CAAC;QAEjC,MAAM,aAAa,MAAM,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACnD,UAAU;gBACR;oBACE,MAAM;oBACN,SAAS;gBACX;gBACA;oBACE,MAAM;oBACN,SAAS;gBACX;aACD;YACD,UAAU;gBAAE,MAAM;YAAW;QAC/B;QAEA,MAAM,eAAe,WAAW,OAAO,CAAC,EAAE,EAAE,SAAS,WAAW;QAEhE,0BAA0B;QAC1B,IAAI;QACJ,IAAI;YACF,0DAA0D;YAC1D,MAAM,YAAY,aAAa,KAAK,CAAC;YACrC,MAAM,WAAW,YAAY,SAAS,CAAC,EAAE,GAAG;YAC5C,WAAW,KAAK,KAAK,CAAC;QACxB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kCAAkC;YAChD,+BAA+B;YAC/B,WAAW;gBACT,MAAM;gBACN,YAAY;gBACZ,UAAU,EAAE;gBACZ,gBAAgB;gBAChB,YAAY;YACd;QACF;QAEA,sCAAsC;QACtC,MAAM,aAAa;YAAC;YAAW;YAAe;YAAc;YAAe;SAAS;QACpF,MAAM,OAAO,WAAW,QAAQ,CAAC,SAAS,IAAI,IAAI,SAAS,IAAI,GAAG;QAClE,MAAM,aAAa,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,IAAI,SAAS,UAAU,IAAI;QACnE,MAAM,WAAW,MAAM,OAAO,CAAC,SAAS,QAAQ,IAAI,SAAS,QAAQ,GAAG,EAAE;QAC1E,MAAM,eAAe,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,IAAI,SAAS,cAAc,IAAI;QACzE,MAAM,aAAa,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,SAAS,UAAU,IAAI;QAEpE,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA;YACA;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QAEjC,2BAA2B;QAC3B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,MAAM;YACN,YAAY;YACZ,UAAU,EAAE;YACZ,cAAc;YACd,YAAY;QACd;IACF;AACF;;;IAnHsB;;AAAA,iPAAA"}}]
}